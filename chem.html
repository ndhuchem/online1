<main id="main-content" class="container">
    <div class="analyzer-wrapper" style="margin: 40px auto; max-width: 800px; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
        <h2 style="color: #1a73e8; border-bottom: 2px solid #e8f0fe; padding-bottom: 10px;">ğŸ§ª åŒ–å­¸åˆ†å­çµæ§‹åˆ†æç³»çµ±(å¯èƒ½å­˜åœ¨å¤§é‡éŒ¯èª¤ è¬¹æ…ä½¿ç”¨)</h2>
        
        <label style="font-weight: bold; display: block; margin-top: 15px;">1. è¼¸å…¥åŒ–å­¸å¼ (æ ¼å¼ï¼š(åŸå­ç¬¦è™Ÿ)(æ•¸é‡))</label>
        <input type="text" id="formula" placeholder="ä¾‹å¦‚ï¼š(C)(1)(O)(2)" style="width: 100%; padding: 12px; margin: 8px 0; border: 1.5px solid #ddd; border-radius: 6px;">
        
        <button class="btn-generate" py-click="generate_ids" style="background: #34a853; color: white; width: 100%; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">1. ç”ŸæˆåŸå­ç·¨è™Ÿ</button>
        
        <div id="id_hint" style="background: #fff3e0; padding: 10px; border-left: 5px solid #ff9800; margin: 10px 0; border-radius: 4px; font-family: monospace;">ç­‰å¾…è¼¸å…¥åŒ–å­¸å¼...</div>
        
        <label style="font-weight: bold; display: block; margin-top: 15px;">2. è¼¸å…¥ç¸½é›»è·</label>
        <input type="number" id="charge" value="0" style="width: 100%; padding: 12px; margin: 8px 0; border: 1.5px solid #ddd; border-radius: 6px;">
        
        <label style="font-weight: bold; display: block; margin-top: 15px;">3. è¼¸å…¥é€£æ¥é—œä¿‚</label>
        <textarea id="bonds" rows="4" placeholder="ä¾‹å¦‚ï¼š0 1" style="width: 100%; padding: 12px; margin: 8px 0; border: 1.5px solid #ddd; border-radius: 6px;"></textarea>
        
        <div class="button-group" style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn-analyze" py-click="run_analysis" style="flex: 1; padding: 12px; background: #1a73e8; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">2. é–‹å§‹åˆ†æçµæœ</button>
            <button class="btn-reset" py-click="reset_all" style="flex: 1; padding: 12px; background: #ea4335; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">é‡è¨­æ¸…é™¤</button>
        </div>
        
        <div id="output" style="background: #202124; color: #e8eaed; padding: 20px; border-radius: 8px; white-space: pre-wrap; margin-top: 20px; font-family: monospace;">åˆ†æçµæœå°‡é¡¯ç¤ºæ–¼æ­¤...</div>

        <div class="return-home" style="text-align: center; margin-top: 20px;">
            <a href="/online1/index.html" class="btn">è¿”å›é¦–é </a>
        </div>
    </div>
    <script type="py">
        from pyscript import document
        import re
        #å…ƒç´ å­—å…¸ 
        ELEMENT_DICT = {
            "H":  {"name": "Hydrogen", "weight": 1.008, "mp": -259.1, "bp": -252.9, "en": 2.20, "ve": 1, "metal": false},
        "He": {"name": "Helium", "weight": 4.003, "mp": -272.2, "bp": -268.9, "en": 0.00, "ve": 2, "metal": false},
        "Li": {"name": "Lithium", "weight": 6.941, "mp": 180.5, "bp": 1342.0, "en": 0.98, "ve": 1, "metal": true},
        "Be": {"name": "Beryllium", "weight": 9.012, "mp": 1287.0, "bp": 2469.0, "en": 1.57, "ve": 2, "metal": true},
        "B":  {"name": "Boron", "weight": 10.81, "mp": 2075.0, "bp": 4000.0, "en": 2.04, "ve": 3, "metal": false},
        "C":  {"name": "Carbon", "weight": 12.01, "mp": 3550.0, "bp": 4827.0, "en": 2.55, "ve": 4, "metal": false},
        "N":  {"name": "Nitrogen", "weight": 14.01, "mp": -210.0, "bp": -195.8, "en": 3.04, "ve": 5, "metal": false},
        "O":  {"name": "Oxygen", "weight": 16.00, "mp": -218.8, "bp": -183.0, "en": 3.44, "ve": 6, "metal": false},
        "F":  {"name": "Fluorine", "weight": 19.00, "mp": -219.6, "bp": -188.1, "en": 3.98, "ve": 7, "metal": false},
        "Ne": {"name": "Neon", "weight": 20.18, "mp": -248.6, "bp": -246.1, "en": 0.00, "ve": 8, "metal": false},
        "Na": {"name": "Sodium", "weight": 22.99, "mp": 97.72, "bp": 883.0, "en": 0.93, "ve": 1, "metal": true},
        "Mg": {"name": "Magnesium", "weight": 24.31, "mp": 650.0, "bp": 1090.0, "en": 1.31, "ve": 2, "metal": true},
        "Al": {"name": "Aluminum", "weight": 26.98, "mp": 660.3, "bp": 2470.0, "en": 1.61, "ve": 3, "metal": true},
        "Si": {"name": "Silicon", "weight": 28.09, "mp": 1414.0, "bp": 3265.0, "en": 1.90, "ve": 4, "metal": false},
        "P":  {"name": "Phosphorus", "weight": 30.97, "mp": 44.15, "bp": 280.5, "en": 2.19, "ve": 5, "metal": false},
        "S":  {"name": "Sulfur", "weight": 32.06, "mp": 115.2, "bp": 444.6, "en": 2.58, "ve": 6, "metal": false},
        "Cl": {"name": "Chlorine", "weight": 35.45, "mp": -101.5, "bp": -34.0, "en": 3.16, "ve": 7, "metal": false},
        "Ar": {"name": "Argon", "weight": 39.95, "mp": -189.3, "bp": -185.8, "en": 0.00, "ve": 8, "metal": false},
        "K":  {"name": "Potassium", "weight": 39.10, "mp": 63.38, "bp": 759.0, "en": 0.82, "ve": 1, "metal": true},
        "Ca": {"name": "Calcium", "weight": 40.08, "mp": 842.0, "bp": 1484.0, "en": 1.00, "ve": 2, "metal": true},
        "Sc": {"name": "Scandium", "weight": 44.96, "mp": 1541, "bp": 2836, "en": 1.36, "ve": 3, "metal": true},
        "Ti": {"name": "Titanium", "weight": 47.87, "mp": 1668, "bp": 3287, "en": 1.54, "ve": 2, "metal": true},
        "V":  {"name": "Vanadium", "weight": 50.94, "mp": 1910, "bp": 3407, "en": 1.63, "ve": 2, "metal": true},
        "Cr": {"name": "Chromium", "weight": 52.00, "mp": 1907, "bp": 2671, "en": 1.66, "ve": 1, "metal": true},
        "Mn": {"name": "Manganese", "weight": 54.94, "mp": 1246, "bp": 2061, "en": 1.55, "ve": 2, "metal": true},
        "Fe": {"name": "Iron", "weight": 55.85, "mp": 1538, "bp": 2862, "en": 1.83, "ve": 2, "metal": true},
        "Co": {"name": "Cobalt", "weight": 58.93, "mp": 1495, "bp": 2927, "en": 1.88, "ve": 2, "metal": true},
        "Ni": {"name": "Nickel", "weight": 58.69, "mp": 1455, "bp": 2730, "en": 1.91, "ve": 2, "metal": true},
        "Cu": {"name": "Copper", "weight": 63.55, "mp": 1085, "bp": 2562, "en": 1.90, "ve": 1, "metal": true},
        "Zn": {"name": "Zinc", "weight": 65.38, "mp": 419.5, "bp": 907, "en": 1.65, "ve": 2, "metal": true},
        "Ga": {"name": "Gallium", "weight": 69.72, "mp": 29.76, "bp": 2204, "en": 1.81, "ve": 3, "metal": true},
        "Ge": {"name": "Germanium", "weight": 72.63, "mp": 938.3, "bp": 2833, "en": 2.01, "ve": 4, "metal": false},
        "As": {"name": "Arsenic", "weight": 74.92, "mp": 817, "bp": 614, "en": 2.18, "ve": 5, "metal": false},
        "Se": {"name": "Selenium", "weight": 78.96, "mp": 221, "bp": 685, "en": 2.55, "ve": 6, "metal": false},
        "Br": {"name": "Bromine", "weight": 79.90, "mp": -7.2, "bp": 58.8, "en": 2.96, "ve": 7, "metal": false},
        "Kr": {"name": "Krypton", "weight": 83.80, "mp": -157.4, "bp": -153.2, "en": 3.00, "ve": 8, "metal": false},
        "Rb": {"name": "Rubidium", "weight": 85.47, "mp": 39.3, "bp": 688.0, "en": 0.82, "ve": 1, "metal": true},
        "Sr": {"name": "Strontium", "weight": 87.62, "mp": 777.0, "bp": 1382.0, "en": 0.95, "ve": 2, "metal": true},
        "Y":  {"name": "Yttrium", "weight": 88.91, "mp": 1526, "bp": 3336, "en": 1.22, "ve": 3, "metal": true},
        "Zr": {"name": "Zirconium", "weight": 91.22, "mp": 1855, "bp": 4409, "en": 1.33, "ve": 4, "metal": true}
        "Nb": {"name": "Niobium", "weight": 92.91, "mp": 2477, "bp": 4744, "en": 1.6, "ve": 5, "metal": true},
        "Mo": {"name": "Molybdenum", "weight": 95.95, "mp": 2623, "bp": 4639, "en": 2.16, "ve": 6, "metal": true},
        "Tc": {"name": "Technetium", "weight": 98.0, "mp": 2157, "bp": 4265, "en": 1.9, "ve": 7, "metal": true},
        "Ru": {"name": "Ruthenium", "weight": 101.1, "mp": 2334, "bp": 4150, "en": 2.2, "ve": 8, "metal": true},
        "Rh": {"name": "Rhodium", "weight": 102.9, "mp": 1964, "bp": 3695, "en": 2.28, "ve": 1, "metal": true},
        "Pd": {"name": "Palladium", "weight": 106.4, "mp": 1555, "bp": 2963, "en": 2.20, "ve": 0, "metal": true},
        "Ag": {"name": "Silver", "weight": 107.9, "mp": 961.8, "bp": 2162.0, "en": 1.93, "ve": 1, "metal": true},
        "Cd": {"name": "Cadmium", "weight": 112.4, "mp": 321.1, "bp": 767.0, "en": 1.69, "ve": 2, "metal": true},
        "In": {"name": "Indium", "weight": 114.8, "mp": 156.6, "bp": 2072.0, "en": 1.78, "ve": 3, "metal": true},
        "Sn": {"name": "Tin", "weight": 118.7, "mp": 231.9, "bp": 2602.0, "en": 1.96, "ve": 4, "metal": true},
        "Sb": {"name": "Antimony", "weight": 121.8, "mp": 630.6, "bp": 1587.0, "en": 2.05, "ve": 5, "metal": false},
        "Te": {"name": "Tellurium", "weight": 127.6, "mp": 449.5, "bp": 988.0, "en": 2.10, "ve": 6, "metal": false},
        "I":  {"name": "Iodine", "weight": 126.9, "mp": 113.7, "bp": 184.3, "en": 2.66, "ve": 7, "metal": false},
        "Xe": {"name": "Xenon", "weight": 131.3, "mp": -111.8, "bp": -108.1, "en": 2.60, "ve": 8, "metal": false},
        "Cs": {"name": "Cesium", "weight": 132.9, "mp": 28.4, "bp": 671.0, "en": 0.79, "ve": 1, "metal": true},
        "Ba": {"name": "Barium", "weight": 137.3, "mp": 727.0, "bp": 1897.0, "en": 0.89, "ve": 2, "metal": true},
        "La": {"name": "Lanthanum", "weight": 138.9, "mp": 920, "bp": 3464, "en": 1.1, "ve": 3, "metal": true},
        "Ce": {"name": "Cerium", "weight": 140.1, "mp": 795, "bp": 3443, "en": 1.12, "ve": 4, "metal": true},
        "Pr": {"name": "Praseodymium", "weight": 140.9, "mp": 931, "bp": 3520, "en": 1.13, "ve": 3, "metal": true},
        "Nd": {"name": "Neodymium", "weight": 144.2, "mp": 1024, "bp": 3074, "en": 1.14, "ve": 2, "metal": true},
        "Pm": {"name": "Promethium", "weight": 145.0, "mp": 1042, "bp": 3000, "en": 1.13, "ve": 3, "metal": true},
        "Sm": {"name": "Samarium", "weight": 150.4, "mp": 1072, "bp": 1794, "en": 1.17, "ve": 2, "metal": true},
        "Eu": {"name": "Europium", "weight": 152.0, "mp": 822, "bp": 1529, "en": 1.2, "ve": 2, "metal": true},
        "Gd": {"name": "Gadolinium", "weight": 157.3, "mp": 1313, "bp": 3273, "en": 1.2, "ve": 2, "metal": true},
        "Tb": {"name": "Terbium", "weight": 158.9, "mp": 1356, "bp": 3230, "en": 1.2, "ve": 3, "metal": true},
        "Dy": {"name": "Dysprosium", "weight": 162.5, "mp": 1412, "bp": 2567, "en": 1.22, "ve": 3, "metal": true},
        "Ho": {"name": "Holmium", "weight": 164.9, "mp": 1474, "bp": 2700, "en": 1.23, "ve": 3, "metal": true},
        "Er": {"name": "Erbium", "weight": 167.3, "mp": 1529, "bp": 2868, "en": 1.24, "ve": 3, "metal": true},
        "Tm": {"name": "Thulium", "weight": 168.9, "mp": 1545, "bp": 1950, "en": 1.25, "ve": 3, "metal": true},
        "Yb": {"name": "Ytterbium", "weight": 173.0, "mp": 824, "bp": 1196, "en": 1.1, "ve": 2, "metal": true},
        "Lu": {"name": "Lutetium", "weight": 175.0, "mp": 1663, "bp": 3402, "en": 1.27, "ve": 3, "metal": true},
        "Hf": {"name": "Hafnium", "weight": 178.5, "mp": 2233, "bp": 4603, "en": 1.3, "ve": 4, "metal": true},
        "Ta": {"name": "Tantalum", "weight": 180.9, "mp": 3017, "bp": 5458, "en": 1.5, "ve": 5, "metal": true},
        "W":  {"name": "Tungsten", "weight": 183.8, "mp": 3422, "bp": 5555, "en": 2.36, "ve": 6, "metal": true},
        "Re": {"name": "Rhenium", "weight": 186.2, "mp": 3186, "bp": 5596, "en": 1.9, "ve": 7, "metal": true},
        "Os": {"name": "Osmium", "weight": 190.2, "mp": 3033, "bp": 5012, "en": 2.2, "ve": 8, "metal": true},
        "Ir": {"name": "Iridium", "weight": 192.2, "mp": 2446, "bp": 4428, "en": 2.20, "ve": 2, "metal": true},
        "Pt": {"name": "Platinum", "weight": 195.1, "mp": 1768, "bp": 3825, "en": 2.28, "ve": 1, "metal": true},
        "Au": {"name": "Gold", "weight": 197.0, "mp": 1064, "bp": 2856, "en": 2.54, "ve": 1, "metal": true},
        "Hg": {"name": "Mercury", "weight": 200.6, "mp": -38.8, "bp": 356.7, "en": 2.00, "ve": 2, "metal": true}
        "Tl": {"name": "Thallium", "weight": 204.4, "mp": 304, "bp": 1473, "en": 1.62, "ve": 3, "metal": true},
        "Pb": {"name": "Lead", "weight": 207.2, "mp": 327.5, "bp": 1749.0, "en": 2.33, "ve": 4, "metal": true},
        "Bi": {"name": "Bismuth", "weight": 209.0, "mp": 271.4, "bp": 1564.0, "en": 2.02, "ve": 5, "metal": true},
        "Po": {"name": "Polonium", "weight": 209.0, "mp": 254, "bp": 962, "en": 2.0, "ve": 6, "metal": true},
        "At": {"name": "Astatine", "weight": 210.0, "mp": 302, "bp": 337, "en": 2.2, "ve": 7, "metal": false},
        "Rn": {"name": "Radon", "weight": 222.0, "mp": -71.0, "bp": -61.7, "en": 2.20, "ve": 8, "metal": false},
        "Fr": {"name": "Francium", "weight": 223.0, "mp": 27, "bp": 677, "en": 0.7, "ve": 1, "metal": true},
        "Ra": {"name": "Radium", "weight": 226.0, "mp": 700, "bp": 1737, "en": 0.9, "ve": 2, "metal": true},
        "Ac": {"name": "Actinium", "weight": 227.0, "mp": 1050, "bp": 3198, "en": 1.1, "ve": 3, "metal": true},
        "Th": {"name": "Thorium", "weight": 232.0, "mp": 1750, "bp": 4788, "en": 1.3, "ve": 4, "metal": true},
        "Pa": {"name": "Protactinium", "weight": 231.0, "mp": 1568, "bp": 4027, "en": 1.5, "ve": 5, "metal": true},
        "U":  {"name": "Uranium", "weight": 238.0, "mp": 1132, "bp": 4131, "en": 1.38, "ve": 6, "metal": true},
        "Np": {"name": "Neptunium", "weight": 237.0, "mp": 644, "bp": 3902, "en": 1.36, "ve": 5, "metal": true},
        "Pu": {"name": "Plutonium", "weight": 244.0, "mp": 640, "bp": 3228, "en": 1.28, "ve": 2, "metal": true},
        "Am": {"name": "Americium", "weight": 243.0, "mp": 1176, "bp": 2607, "en": 1.3, "ve": 2, "metal": true},
        "Cm": {"name": "Curium", "weight": 247.0, "mp": 1345, "bp": 3110, "en": 1.3, "ve": 3, "metal": true},
        "Bk": {"name": "Berkelium", "weight": 247.0, "mp": 986, "bp": 2627, "en": 1.3, "ve": 3, "metal": true},
        "Cf": {"name": "Californium", "weight": 251.0, "mp": 900, "bp": 1470, "en": 1.3, "ve": 2, "metal": true},
        "Es": {"name": "Einsteinium", "weight": 252.0, "mp": 860, "bp": 996, "en": 1.3, "ve": 2, "metal": true},
        "Fm": {"name": "Fermium", "weight": 257.0, "mp": 1527, "bp": 0, "en": 1.3, "ve": 2, "metal": true},
        "Md": {"name": "Mendelevium", "weight": 258.0, "mp": 827, "bp": 0, "en": 1.3, "ve": 1, "metal": true},
        "No": {"name": "Nobelium", "weight": 259.0, "mp": 827, "bp": 0, "en": 1.3, "ve": 2, "metal": true},
        "Lr": {"name": "Lawrencium", "weight": 262.0, "mp": 1627, "bp": 0, "en": 1.3, "ve": 3, "metal": true},
        "Rf": {"name": "Rutherfordium", "weight": 267.0, "mp": 2100, "bp": 5500, "en": 0, "ve": 4, "metal": true},
        "Db": {"name": "Dubnium", "weight": 268.0, "mp": 0, "bp": 0, "en": 0, "ve": 5, "metal": true},
        "Sg": {"name": "Seaborgium", "weight": 269.0, "mp": 0, "bp": 0, "en": 0, "ve": 6, "metal": true},
        "Bh": {"name": "Bohrium", "weight": 270.0, "mp": 0, "bp": 0, "en": 0, "ve": 7, "metal": true},
        "Hs": {"name": "Hassium", "weight": 269.0, "mp": 0, "bp": 0, "en": 0, "ve": 8, "metal": true},
        "Mt": {"name": "Meitnerium", "weight": 278.0, "mp": 0, "bp": 0, "en": 0, "ve": 9, "metal": true},
        "Ds": {"name": "Darmstadtium", "weight": 281.0, "mp": 0, "bp": 0, "en": 0, "ve": 10, "metal": true},
        "Rg": {"name": "Roentgenium", "weight": 282.0, "mp": 0, "bp": 0, "en": 0, "ve": 11, "metal": true},
        "Cn": {"name": "Copernicium", "weight": 285.0, "mp": 0, "bp": 67, "en": 0, "ve": 2, "metal": true},
        "Nh": {"name": "Nihonium", "weight": 286.0, "mp": 430, "bp": 1100, "en": 0, "ve": 3, "metal": true},
        "Fl": {"name": "Flerovium", "weight": 289.0, "mp": -73, "bp": 150, "en": 0, "ve": 4, "metal": true},
        "Mc": {"name": "Moscovium", "weight": 290.0, "mp": 400, "bp": 1100, "en": 0, "ve": 5, "metal": true},
        "Lv": {"name": "Livermorium", "weight": 293.0, "mp": 400, "bp": 800, "en": 0, "ve": 6, "metal": true},
        "Ts": {"name": "Tennessine", "weight": 294.0, "mp": 400, "bp": 550, "en": 0, "ve": 7, "metal": false},
        "Og": {"name": "Oganesson", "weight": 294.0, "mp": 50, "bp": 80, "en": 0, "ve": 8, "metal": false}
    }
        def parse_formula(): # åŒ–å­¸å¼è§£æå‡½æ•¸
            formula_str = document.querySelector("#formula").value #å¾HTMLå–å¾—åŒ–å­¸å¼å­—ä¸²
            nodes = []
            matches = re.findall(r"\(([A-Za-z]+)\)\((\d+)\)", formula_str) #ä½¿ç”¨è¡¨é”å¼æŠ“å–æ‹¬è™Ÿå…§çš„å…§å®¹ å…ƒç´ ç¬¦è™Ÿ æ•¸é‡
            for sym, count in matches:
                if sym in ELEMENT_DICT:
                    for _ in range(int(count)): #æ“šæ•¸é‡å°‡åŸå­å­˜å…¥nodesåˆ—è¡¨ åˆå§‹åŒ–è©²åˆ†å­çš„å‰©é¤˜åƒ¹é›»å­æ•¸ (rem_e)
                        nodes.append({"sym": sym, "rem_e": ELEMENT_DICT[sym]["ve"]})
            return nodes
        def generate_ids(event): #ç¶²é äº¤äº’å‡½æ•¸ï¼šç”Ÿæˆç·¨è™Ÿ
            nodes = parse_formula() 
            hint_div = document.querySelector("#id_hint") #ç•¶ä½¿ç”¨è€…é»æ“Šã€ç”Ÿæˆç·¨è™Ÿã€æ™‚åŸ·è¡Œï¼Œé¡¯ç¤ºåŸå­èˆ‡å°æ‡‰ç´¢å¼•
            if not nodes: #ç•¶ä¸ç¬¦åˆæ¨™æº–åŒ–å­¸å¼æ™‚é¡¯ç¤ºè­¦å‘Šè¨Šæ¯
                hint_div.innerText = "âš  æ ¼å¼ä¸æ­£ç¢ºï¼è«‹ä½¿ç”¨ (C)(1)(O)(2) æ ¼å¼ã€‚"
                return
            hints = [f"[{i}]:{n['sym']}" for i, n in enumerate(nodes)] #ç”ŸæˆåŸå­æ¨™è™Ÿå­—ä¸²ä¸¦è¿”å›html
            hint_div.innerText = "åŸå­ç·¨è™Ÿï¼š " + "  ".join(hints)
            document.querySelector("#bonds").placeholder = "è‹¥ç·¨è™Ÿ 0 èˆ‡ 1 æœ‰é€£æ¥ï¼Œè«‹åœ¨æ­¤è¼¸å…¥ï¼š0 1"
        def run_analysis(event): # æ ¸å¿ƒé‹ç®—å‡½æ•¸ï¼šåŸ·è¡Œçµæ§‹åˆ†æ
            output_div = document.querySelector("#output")
            nodes = parse_formula()
            if not nodes:
                output_div.innerText = "éŒ¯èª¤ï¼šè«‹å…ˆè¼¸å…¥åŒ–å­¸å¼ä¸¦é»æ“Šç”Ÿæˆç·¨è™Ÿã€‚"
                return
            charge = int(document.querySelector("#charge").value or 0) # è®€å–é›»è·ï¼ˆå½±éŸ¿ä¸­å¿ƒåŸå­é›»å­æ•¸ï¼‰èˆ‡é€£æ¥é—œä¿‚æ–‡å­—
            bonds_str = document.querySelector("#bonds").value
            total_atoms = len(nodes)
            adj = [[0] * total_atoms for _ in range(total_atoms)] # åˆå§‹åŒ–é„°æ¥çŸ©é™£ (adj)ï¼Œç”¨ä¾†ç´€éŒ„åŸå­é–“çš„éµæ•¸ (0=æ²’é€£, 1=å–®éµ, 2=é›™éµ)
            for line in bonds_str.strip().split('\n'): #è§£æé€£æ¥é—œä¿‚
                try:
                    parts = line.split()
                    if len(parts) == 2:
                        a, b = map(int, parts)
                        if a < total_atoms and b < total_atoms:
                            adj[a][b] = adj[b][a] = 1   
                except: continue
            #è‡ªå‹•éµçµé‚è¼¯ 
            if total_atoms > 0:
                nodes[0]["rem_e"] -= charge # å°‡é›»è·æ”¾å…¥ä¸­å¿ƒåŸå­
            # è¨ˆç®—å…¨å–®éµ
            for i in range(total_atoms):
                for j in range(i + 1, total_atoms):
                    if adj[i][j] >= 1:
                        nodes[i]["rem_e"] -= 1
                        nodes[j]["rem_e"] -= 1
            # å˜—è©¦å¤šéµåˆ†é…
            for i in range(total_atoms):
                while nodes[i]["rem_e"] > 0:
                    added = False
                    for j in range(total_atoms):
                        if adj[i][j] >= 1 and nodes[j]["rem_e"] > 0: #è‹¥å…©è€…æœ‰ç›¸é€£ä¸”é›™æ–¹éƒ½æœ‰å‰©é¤˜é›»å­ï¼Œå‰‡å¢åŠ éµæ•¸
                            adj[i][j] += 1
                            adj[j][i] += 1
                            nodes[i]["rem_e"] -= 1
                            nodes[j]["rem_e"] -= 1
                            added = True
                            break
                    if not added: break
            res = f"{'ç·¨è™Ÿ':<6} {'åŸå­':<6} {'ç¸½éµæ•¸':<8} {'éµç´šåˆ†é…':<12} {'LP':<6} {'ç©ºé–“å½¢ç‹€':<12}\n"
            res += "="*60 + "\n"
            max_en, min_en, has_HB = -1.0, 10.0, False
            for i in range(total_atoms):
                sym = nodes[i]["sym"]
                e_data = ELEMENT_DICT[sym]
                # çµ±è¨ˆé›»è² åº¦
                if e_data["en"] > max_en: max_en = e_data["en"]  #æ›´æ–°åˆ†å­å…§æœ€é«˜èˆ‡æœ€ä½é›»è² åº¦
                if e_data["en"] > 0 and e_data["en"] < min_en: min_en = e_data["en"]
                b_sum, nbr, desc = 0, 0, ""
                for j in range(total_atoms):
                    if adj[i][j] > 0:
                        bond_order = adj[i][j]  #å–å¾—éµç´š
                        b_sum += bond_order  #ç´¯åŠ ç¸½éµæ•¸
                        nbr += 1  #ç´¯åŠ é„°å±…åŸå­æ•¸ (å³ VSEPR ä¸­çš„ X)
                        desc += f"{bond_order}-"  #è¨˜éŒ„åˆ†é…æƒ…æ³å¦‚ "2-1-"
                        neighbor_sym = nodes[j]["sym"]
                        if sym == "H" and (neighbor_sym in ["F", "O", "N"]): #æ°«éµåˆ¤æ–·ï¼šè‹¥ H åŸå­é€£æ¥åœ¨ F, O, N ä¸Š
                            has_HB = True
                lp = max(0, nodes[i]["rem_e"] // 2)  #è¨ˆç®—LP,å³VSEPRä¸­çš„E å‰©é¤˜é›»å­é™¤ä»¥ 2
                sn = nbr + lp
                sh = "æœ«ç«¯"
                if sn == 4:
                    sh = "å››é¢é«”" if lp == 0 else ("ä¸‰è§’éŒ" if lp == 1 else "è§’å½¢")
                elif sn == 3:
                    sh = "å¹³é¢ä¸‰è§’" if lp == 0 else "è§’å½¢"
                elif sn == 2:
                    sh = "ç·šæ€§"
                res += f"{i:<8} {sym:<8} {b_sum:<10} {desc:<14} {lp:<8} {sh}\n"
            #ä½œç”¨åŠ›åˆ¤æ–·é‚è¼¯
            de = max_en - min_en
            force_list = ["å€«æ•¦åˆ†æ•£åŠ›"]
            if has_HB: force_list.insert(0, "æ°«éµ")
            if de > 0.5: force_list.insert(0, "å¶æ¥µ-å¶æ¥µåŠ›")
            report = f"\n[åˆ†æå ±å‘Š]\n"
            report += f"æ¥µæ€§å¼·åº¦ (Î”EN): {de:.2f}\n"
            report += f"ä¸»è¦ä½œç”¨åŠ›: {', '.join(force_list)}\n"
            output_div.innerText = res + report
        def reset_all(event):
            document.querySelector("#formula").value = ""
            document.querySelector("#charge").value = "0"
            document.querySelector("#bonds").value = ""
            document.querySelector("#id_hint").innerText = "ç­‰å¾…è¼¸å…¥åŒ–å­¸å¼..."
            document.querySelector("#output").innerText = "åˆ†æçµæœå°‡é¡¯ç¤ºæ–¼æ­¤..."
    </script>
</main>